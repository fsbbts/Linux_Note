# Linux学习笔记



## Linux的安装

1. 在主机（windows）上安装VM虚拟机
2. 虚拟机上安装centos7.6、Ubuntu、centos8.1（Linux）每一个都是单独的一个虚拟系统 

3. Linux分区：boot（引导）1GB， swap 2GB， 根分区剩下所有的空间
4. 补：swap分区相当于对内存的补充，临时充当内存
5. 虚拟机上的网络设置：
   - 桥接模式：虚拟系统可以和外部系统通讯， 但只能在一个网段，容易造成IP冲突
   - NAT模式：网络地址转换模式， 虚拟系统可以和外部通讯，且不造成IP冲突（虚拟系统使用另一个网段， 通过主机IP代理）
   - 主机模式：独立的系统



## 虚拟机的克隆

（用vmware，先关闭运行中的虚拟机， 再进行虚拟机克隆）

- 浅拷贝：创立链接， 相当于引用
- 深拷贝：创立一个完整的空间， 开辟一个相同的空间

**注意：拷贝的文件甚至可以发送到别的PC上，再用vmware打开，内容一样**

**目的：方便创立一个集群**



##虚拟机快照

<u>*在虚拟机系统（Linux）做下一个可能会导致虚拟机异常的操作时，通过虚拟机快照回到之前的状态*</u>

1. 右击虚拟机，点击快照，可以给予备注
2. 可以多次进行快照
3. 点击快照管理，可以选择，去哪一个分支



## 虚拟机迁移和删除

- 迁移：移动虚拟系统文件夹即可
- 删除：先在vmware里移除， 再去对应文件夹删除文件即可



## vmtools的安装

**目的：可以设置windows和centos共享文件夹**

- vmtools安装：
  1. **注意：在root用户中进行操作， 且先弹出原有的光盘**
  2. 点击虚拟机， 重新安装vmtools （是个光盘）
  3. 将里面的 压缩包 复制到 其他设备->计算机->opt文件
  4. 打开终端， cd /opt/ 进入opt文件， ls查看到有个压缩包
  5. tar -zxvf(....)进行解压
  6. 进入解压的目录， cd vmware...  , ls看到有个绿色的install安装文件， ./(....)安装即可
  7. 看到 VMware team 即是安装成功
- MyShare设置：
  1. 在主机创建一个MyShare文件夹
  2. 右击虚拟机 -> 设置 -> 选项 -> 共享文件夹 -> 设置路径
  3. MyShare在虚拟机的/mnt目录下

**Tip:实际工作中， 采用远程传送文件夹而非用MyShare共享**



## Linux目录结构（目录树）

==**Linux的世界里， 一切都是文件（包扩各类软件， 也包括各类硬件如CPU, Disk）， 各类名字都是固定的**==

- **/**         [根目录]

- **/bin   **[存放最经常使用的命令]

- /sbin  [系统管理员常用指令]

- **/home  ** [除了root用户之外， 其他用户的文件] 

`useradd A //就是创建A用户的文件`

`userdel -r A //销毁A用户的文件`

- **/root**   [系统管理员的文件， 只有root用户才能打开]

- **/lib**      [系统开机所需的动态连接共享库， 类似于windows里的DLL， 所有应用程序都需要用到这个共享库]

- **/lost+found**  [当系统非法关机后， 这里面会存放一些文件，一般是隐藏的，在终端cd /进入根目录， 再ls 即可显示/lost+found]

- **/etc **    [系统管理， 应用程序的配置文件]

- **/usr**     [用户安装的文件/应用程序都在里面， 类似于Windows的Program Files]

- **/boot**  [放Linux的一些启动文件， 若破坏， Linux启动不了， 不能动]

- **/proc**  [虚拟目录， 系统内存的映射， 不能动， 否则Linux会崩溃]

- **/srv**    [service缩写， 存放服务启动之后需要提取的数据，不能动]

- **/sys**    [Linux内核文件， 不能动]

- **/temp** [存放临时文件]

- **/dev**   [device缩写， Linux的设备管理器， 将硬件以文件形式来存储]

- **/media**  [Linux会自动识别一些设备， 例如U盘， 光驱， 识别之后，将识别的设备挂载到这个目录下]

- **/mnt**   [为了让用户临时挂载别的文件系统， 可以将外部存储挂载到/mnt下, 进入该目录即可查看内容，如D: /MyShare] 

*挂载：外部文件系统，通过挂载到/mnt目录下，使得虚拟机也可以对这个外部文件系统进行操作*

- **/opt**   [给主机额外安装软件（压缩包）所存放的目录， 一般是下载一些软件 安装到/opt目录下]

- **/usr/local**  [给另外一个主机额外安装软件（程序）所存放的目录， 目标目录， 通过编译源码的方式安装]

- **/var**   [存放不断扩充的东西， 包括各种日志文件]

- **/selinux [security-enhanced linux]**  [安全子系统， 启用了这个系统， 才会有这个文件夹】



## Linux 远程登录

- Linux服务器由小组共享，架设在公网上

- 程序员需要通过远程登录到Linux进行项目管理或者开发

- 通过xshell登录Linux服务器

- 通过xftp上传、下载文件

  在官网上下载xshell&xftp可以一起下载

- 连接到Linux服务器需要它的ip地址，在Linux终端输入ifconfig查看ip地址，再在主机cmd中ping (Linux的ip)，查看两者网络是否可以连通，0%丢包率证明ping通
- xshell连接Linux服务器方法：
  1. 打开xshell，新建，主机为Linux服务器的ip，名称随意
  2. 协议是SSH，关闭新建窗口
  3. 再打开，可以选择（接收并保存，下次不用输入密码），输入用户名，密码
  4. 此时，已经成功登录Linux公网，可以通过指令访问Linux服务器的文件

- xftp连接Linux服务器方法：

  1. 打开xftp，新建，跟xshell连接方式一样，连接Linux服务器

  2. 连接之后可以看到左边是自己的文件，右边是服务器文件，可以靠文件直接拖拽进行下载和上传

  3. **若Linux文件乱码，则是编码问题，点左上角文件，当前会话属性，选项，编码改为UTF-8即可**

     

## Vi和Vim编辑器

- Linux内置Vi编辑器，类似于windows里的记事本
- Vim是Vi的增强版本，具有程序编辑的能力，可以代码补全，字体颜色，辨别语法正确性等
- Vi和Vim常用的三种模式
  1. 正常模式：Vim/Vi打开一个档案就进入正常模式（默认模式），在这个模式下，可以上下左右**移动光标**，**删除字符**，**删除整行**，**复制粘贴**
  2. 插入模式：按下i，I，o，O，r，R，a，A任意一个键，即可进入插入模式，在这个模式下，可以进行**编辑**，一般来说按i即可
  3. 命令行模式：先输入esc（按esc键），再输入： （若再加wq表示写入并退出）即可进入命令行模式，在这个模式下，可以提供相关指令，完成读取，存盘，替换，离开vim，显示行号等

- 输入ls即可看到hello.java文件，可以输入vim hello.java（这里可以输一半然后Tab自动补全）再一次进入vim编辑器中

## Vi/Vim模式切换

![](C:\Users\naruto\Desktop\384DN}`_VN_YVU8[DNMQKL0.png)

- 命令行输入 `vim hello.java` 进入正常模式，输入`i`进入编辑模式，esc回退到正常模式，输入:进入到命令模式，输入`:wq`保存退出 / `q`退出 /`q!`强制退出不保存 
- 快捷键使用：
  1.  拷贝当前行 `yy` ，拷贝当前行向下的五行，`5yy`，并粘贴（输入p）
  2. 删除当前行 `dd` ，删除当前行向下的五行， `5dd`
  3. 在文件夹中查找某个单词[命令行下输入 /关键字 ]，回车查找，若有光标会直接移动过去，若无，会提示，输入 `n` 就是查找下一个
  4. 设置行号，取消行号：命令行下   `:set nu`     `:set nonu`
  5. 找到首行、末行：在一般模式下输入`G`到末行文首，输入`gg`到首行文首
  6. 撤销上一个操作，不管这个操作是在哪个模式下完成的，都需要esc回退到正常模式，输入`u`撤销上一次操作，可以一直撤销，按行来算
  7. 将光标移动到指定行：在一般模式下输入`行号 `再同时按shift和g

- 应用场景：vim一般用于在xshell里对linux服务器进行操作，比较少，记住上述几个快键键即可，实际上进行Linux开发还是先在自己的windows系统上进行开发在上传到Linux服务器，用vim、xshell的情况较少



## 关机重启指令

- `shutdown -h now` 立刻关机 `-h`是halt的意思

- `shutdown -h 1` 一分钟后关机，输入`shutdown` 默认是`shutdown -h 1` 

- `shutdown -r now` 立刻重启 `-r`是reboot的意思

- `halt` 关机，跟上面`shutdown -h now` 一样是立刻关机

- `reboot` 立刻重启计算机

- `sync` 将内存数据同步到磁盘

  **不论关机还是重启，在关机前都要先执行`sync`保存数据到磁盘，否则会造成数据丢失。**

  **现在的`shutdown`,`halt`,`reboot`,都自带在执行相应操作（关机前）之前有个`sync`操作**

  

## 用户登录和注销

- 工作中很少直接用root账号登录，root账号有最大的权限。

- 普通用户切换成root用户：登录后在终端输入`su - 用户名`切换成root用户，这里输入密码是不会显示出来的

- 注销用户（登出）：在提示符下输入logout即可注销用户（如登录admin，切换成root用户，logout一次回到admin再logout一次退出Linux系统）

  **注意：logout指令在图形运行级别无效，在运行级别3下有效，就是说终端输入logout没用，在xshell里输入有用**



## 用户管理

介绍：Linux系统是一个多用户多任务的操作系统，任何一个要使用系统资源的用户，都必须首先向系统管理员申请一个账号，然后以这个账号的身份进入系统

**1. 创建新用户**

- 基本语法： `useradd 用户名` ，创建完一个用户后会在/home下添加对应文件夹，如`adduer tom` 则会创建`/home/tom`

- 也可以 指定路径下创建新用户 ：`useradd -d /home/文件名  文件名`（第一个文件名不能省略，会显示出来，第二个文件名不能省略，但是不会显示出来？**第二个文件名是用户名，第一个文件名是这个用户的家目录名**）
  - 就是说 `useradd -d /home/test queen`创建一个新用户queen，queen的家文件名叫test，可以用`su - queen`切换成queen用户`cd home`可以看到所有用户的家文件，包括自己的`test`但是其他人的家文件进不去，权限不够，只能进入自己的家文件

**2.设置用户密码**

- 基本语法：`passwd 用户名`，默认给当前登录的用户修改密码，注意看清楚，不能把root密码给修改了
- 修改密码需要root用户才可以`su - root`，可以切换到root用户
- 补充：`pwd`查看当前在哪个目录下，比如说登录queen用户后，输入`pwd`显示在/home/test因为test是queen的家文件

**3.删除用户**

**自己不能删自己，删除用户需要root用户权限**

- 基本语法：`userdel 用户名`
- 删除用户，但保留家目录：`userdel 用户名`
- 删除用户以及家目录：`userdel -r 用户名 ` （慎用）
- **root用户删除其他用户的时候，要保证其他用户是退出登录的，否则删不掉，保险做法就是重启用root登录来删**
- 这些都是用xshell完成，在Linux终端也可以进行删除用户的操作

**4.查询用户信息**

- 基本语法：`id 用户名`
- 查得到则显示信息，查不到则显示查不到

**5.切换用户**

介绍：在Linux系统中如果当前用户的权限不够，可以通过切换到高权限用户，比如root

- 基本语法：`su -  用户名`

- 从高权限用户切换到低权限用户不需要密码，从低权限用户切换到高权限用户，比如root，需要密码
- 当需要返回到原来用户，输入`exit / logout ` 
- 如果从root -> admin -> root -> admin 那么输入三次exit回退到初始的root，再回退一次退出系统

**6.查看当前用户**

- 基本语法：`whoami / who am i`
- 当输入`whoami`时，表示的是当前用户，当输入的是`who am i`时，表示的是初始登录系统的用户

**7.用户组**

- 介绍：类似于角色，系统可以对多个具有 共性/相同权限 的用户进统一管理
  - 假如有A, B, C, D 四个用户，若A, B, C 都要赋予同一个权限，一个个赋予太麻烦，就将这三个放到同一个组里，对着个组赋予权限，组里所有的用户都有这个权限了。
  - 当创建了一个用户，同时就会创建同名的组，这个用户就在这个同名组里，这个组也可以使用
  - 创立组需要root用户

- 新增组：`groupadd 组名`

- 删除组：`groupdel 组名`

- 把用户加到一个组里：`useradd -g 用户组 用户名` 在新建用户的时候就把用户加到某个用户组里

- 修改用户的组：`usermod -g 用户组 用户名` 

  **注意：-删除一个组，那这个组必须是空白才能删，否则删不了**

  ​			**-并且在创建用户出现的同名组，当用户修改组之后，这个同名组就消失了**

**8.用户和组相关文件**

- /etc/passwd 文件   （用户的配置文件，记录用户的各种信息）

  每行的含义：用户名：口令（一般看不到）：用户标识号（uid）：组标识号（gid）：注释性描述：主目录（家目录）：登录shell

  **shell是什么？ ->命令解释器 （比如在xshell里写入cd，cd指令不会直接发送给Linux内核，而是先用一个解释器解释，解释之后再发送给Linux内核，我们通常用的是bash）**

​	 `vim /etc/passwd`即可打开，按G，就能看到每一行

- /etc/shadow 文件    （口令的配置文件）

  每行的含义：登录名：加密口令：最后一次修改时间：最小时间间隔：最大时间间隔：警告事件：不活动时间：失效时间：标志     **除了登录名和加密口令，其他都看不懂的**

  加密口令就是密码，但是加密过后的，也看不懂

  `vim /etc/shadow`即可打开

- /etc/group 文件 （组配置文件，包含Linux的组的各种信息）

  每行的含义：组名：口令：组标识号：组内用户列表

  新生成的用户的默认组 这里也能看到

  `vim /etc/group`即可打开

  

